#!/bin/bash
# make sure there is no preexisting Docker CID file
rm -f /Users/dinazielinski/Desktop/terraPipelines/scAtlas/optimus/cromwell-executions/Optimus/a0c421eb-3fda-417f-a8c1-7918278c7e97/call-ReferenceCheck/execution/docker_cid
# run as in the original configuration without --rm flag (will remove later)
docker run \
  --cidfile /Users/dinazielinski/Desktop/terraPipelines/scAtlas/optimus/cromwell-executions/Optimus/a0c421eb-3fda-417f-a8c1-7918278c7e97/call-ReferenceCheck/execution/docker_cid \
  -i \
   \
  --entrypoint /bin/bash \
  -v /Users/dinazielinski/Desktop/terraPipelines/scAtlas/optimus/cromwell-executions/Optimus/a0c421eb-3fda-417f-a8c1-7918278c7e97/call-ReferenceCheck:/cromwell-executions/Optimus/a0c421eb-3fda-417f-a8c1-7918278c7e97/call-ReferenceCheck:delegated \
  gcr.io/gcp-runtimes/ubuntu_16_0_4@sha256:025124e2f1cf4d29149958f17270596bffe13fc6acca6252977c572dd5ba01bf /cromwell-executions/Optimus/a0c421eb-3fda-417f-a8c1-7918278c7e97/call-ReferenceCheck/execution/script

# get the return code (working even if the container was detached)
rc=$(docker wait `cat /Users/dinazielinski/Desktop/terraPipelines/scAtlas/optimus/cromwell-executions/Optimus/a0c421eb-3fda-417f-a8c1-7918278c7e97/call-ReferenceCheck/execution/docker_cid`)

# remove the container after waiting
docker rm `cat /Users/dinazielinski/Desktop/terraPipelines/scAtlas/optimus/cromwell-executions/Optimus/a0c421eb-3fda-417f-a8c1-7918278c7e97/call-ReferenceCheck/execution/docker_cid`

# return exit code
exit $rc
